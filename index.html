<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>오늘의 회화 영단어</title>
<style>
  :root{
    --blue:#1f6ff0; --blue2:#0e5de5; --green:#15a36e; --red:#e64545;
    --card:#ffffff; --bg:#f6f7fb; --text:#0b1220; --muted:#7b8194; --radius:18px;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);
       font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,
       Apple SD Gothic Neo,Malgun Gothic,Segoe UI Emoji,Arial,sans-serif}
  /* 헤더 */
  .appbar{position:sticky;top:0;z-index:20;padding:14px 16px 18px;
          background:linear-gradient(90deg,var(--blue),var(--blue2));color:#fff}
  .appbar .row{display:flex;align-items:center;justify-content:space-between}
  .brand .sub{font-weight:800;letter-spacing:-.2px;opacity:.95}
  .icon-btn{display:inline-flex;align-items:center;justify-content:center;
            width:44px;height:44px;border-radius:14px;border:0;cursor:pointer;
            color:#fff;background:rgba(255,255,255,.16);backdrop-filter:blur(6px)}
  /* 본문 */
  .container{padding:14px 16px 28px;max-width:860px;margin:0 auto}
  .panel{background:var(--card);border-radius:var(--radius);padding:16px;
         box-shadow:0 6px 24px rgba(20,32,80,.08)}
  .datebar{display:grid;grid-template-columns:56px 1fr 56px;gap:10px;align-items:center;margin-bottom:12px}
  .round{height:44px;border-radius:14px;border:1px solid #e7eaf3;background:#fff;cursor:pointer;font-weight:700}
  .date-chip{width:100%;text-align:center;padding:10px 12px;border-radius:24px;background:#fff;border:1px solid #e9ecf2;
             font-weight:800;letter-spacing:.5px;font-size:clamp(18px,3.5vw,22px);line-height:1.1;color:#1b1f2a}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .btn{padding:14px 10px;border-radius:14px;border:1px solid #e7eaf3;background:#fff;font-weight:800;cursor:pointer}
  .btn.green{background:var(--green);border-color:var(--green);color:#fff}
  .btn.red{background:var(--red);border-color:var(--red);color:#fff}
  .row2{display:flex;gap:12px;margin-top:12px;align-items:center;flex-wrap:wrap}
  .tiny-icon{width:44px;height:44px;border-radius:12px;border:1px solid #e7eaf3;background:#fff;
             display:inline-flex;align-items:center;justify-content:center;cursor:pointer;font-size:20px;font-weight:900}
  .section{margin-top:14px}
  .list-area{margin-top:16px;background:#fff;border:1px solid #e7eaf3;border-radius:16px;padding:14px;color:#5c6275}

  @media (min-width:760px){ .grid{grid-template-columns:repeat(4,1fr)} }

  /* 로그인 슬라이더(전면 고정) */
  .sheet{position:fixed;inset:0;z-index:50;display:none}
  .sheet.open{display:block}
  .sheet .backdrop{position:absolute;inset:0;background:rgba(0,0,0,.32)}
  .sheet .panel{
    position:absolute;top:0;right:0;height:100vh;max-width:520px;width:min(92vw,520px);
    background:#fff;border-radius:16px 0 0 16px;padding:20px 16px 28px;
    box-shadow:-10px 0 28px rgba(0,0,0,.18);overflow:auto}
  .sheet .close{position:sticky;top:0;margin-left:auto;border:0;background:#f0f2f7;border-radius:12px;width:40px;height:40px;cursor:pointer}
  .field{display:flex;flex-direction:column;gap:6px;margin:12px 0}
  .input{height:48px;border:1px solid #e7eaf3;border-radius:12px;padding:0 12px;font-size:16px}
  .primary{display:block;width:100%;height:48px;border-radius:12px;border:0;background:var(--blue2);color:#fff;font-weight:800;cursor:pointer}
  .muted-link{color:var(--muted);text-decoration:none}

  /* 기록 삭제는 기록 탭일 때만 보임 */
  #btnDeleteLog{display:none}
  .logs-open #btnDeleteLog{display:inline-block}
</style>
</head>
<body>
  <!-- 헤더 -->
  <header class="appbar">
    <div class="row">
      <div class="brand"><div class="sub">오늘의 회화 영단어</div></div>
      <div style="display:flex;gap:10px">
        <button id="playAllBtn" class="icon-btn" title="전체 재생">▶</button>
        <button id="moreBtn" class="icon-btn" title="계정">⋯</button>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="panel" id="mainPanel">
      <!-- 날짜 바 -->
      <div class="datebar">
        <button id="prevDayBtn" class="round" aria-label="이전 날짜">◀</button>
        <div id="dateChip" class="date-chip">YYYY-MM-DD</div>
        <button id="nextDayBtn" class="round" aria-label="다음 날짜">▶</button>
      </div>

      <!-- 컨트롤 -->
      <div class="grid">
        <button id="btnAllPlay" class="btn">전체 재생</button>
        <button id="btnStop" class="btn">정지</button>
        <button id="btnDone" class="btn green">오늘분 완료</button>
        <button id="btnToday" class="btn">오늘의 단어</button>
      </div>

      <div class="row2">
        <button id="btnHardTiny" class="tiny-icon" title="어려운 단어">☆</button>
        <button id="btnLog" class="btn" style="flex:1">기록</button>
        <button id="btnDeleteLog" class="btn red" style="flex:1">기록 삭제</button>
        <button id="btnStudy" class="btn" style="flex:1">학습하기</button>
      </div>

      <div class="section">
        <div style="font-weight:800;margin-bottom:6px">속도</div>
        <input id="speedRange" type="range" min="0.6" max="1.4" step="0.1" value="1.0" style="width:100%">
      </div>

      <!-- 단어 리스트 -->
      <div id="listArea" class="list-area">여기에 단어 리스트가 렌더링됩니다…</div>
    </section>
  </main>

  <!-- 로그인 슬라이더 -->
  <aside id="accountSheet" class="sheet" aria-hidden="true">
    <div class="backdrop" id="sheetBackdrop"></div>
    <div class="panel" role="dialog" aria-label="계정">
      <button class="close" id="sheetClose" aria-label="닫기">✕</button>
      <h2 style="margin:6px 4px 10px;font-size:28px">계정</h2>

      <!-- 간단 로그인 폼(시각용) -->
      <div class="field">
        <label>이메일</label>
        <input id="email" class="input" type="email" placeholder="you@example.com"/>
      </div>
      <div class="field">
        <label>비밀번호</label>
        <input id="password" class="input" type="password" placeholder="8자리 이상"/>
      </div>
      <button class="primary" id="loginBtn">로그인</button>
      <div style="margin-top:12px">
        <a href="#" class="muted-link" id="noLogin">로그인하지 않음</a>
      </div>
    </div>
  </aside>

<script>
/* ===== 날짜/포맷 ===== */
const dateChip = document.getElementById('dateChip');
let currentDate = new Date();

const fmt = (d) => {
  const y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,'0'), day=String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${day}`;
};
function renderDateChip(){ dateChip.textContent = fmt(currentDate); }
function setDate(d){ currentDate = new Date(d.getFullYear(), d.getMonth(), d.getDate()); renderDateChip(); onDateChanged(fmt(currentDate)); }
function shiftDate(days){ const d=new Date(currentDate); d.setDate(d.getDate()+days); setDate(d); }
function goToday(){ setDate(new Date()); }
function markDoneAndNext(){
  try{ if (typeof window.onMarkDone==='function') window.onMarkDone(fmt(currentDate)); }catch(e){}
  shiftDate(1);
}

/* ===== JSON 로딩(여러 경로 시도) ===== */
async function tryFetchJSON(paths){
  for (const p of paths){
    try{
      const res = await fetch(p, {cache:'no-store'});
      if (res.ok){
        return await res.json();
      }
    }catch(e){ /* 계속 시도 */ }
  }
  throw new Error('모든 경로에서 로딩 실패');
}
async function loadWordsFor(iso){
  const datePaths = [
    `./words/${iso}.json`, `words/${iso}.json`, `/words/${iso}.json`
  ];
  for (const p of datePaths){
    try{ return await tryFetchJSON([p]); }catch(e){}
  }
  const listPaths = [`./words.json`,`words.json`,`/words.json`];
  try{ return await tryFetchJSON(listPaths); }catch(e){}
  // fallback demo
  return [
    {en:'make do with', ko:'임시방편으로 사용하다', ex:'We had to make do with what we had.'},
    {en:'stick to', ko:'고수하다', ex:'Please stick to the plan.'},
    {en:'get along with', ko:'잘 지내다', ex:'Do you get along with your neighbors?'}
  ];
}
function renderWords(list){
  const box = document.getElementById('listArea');
  if (!list || !list.length){
    box.textContent = '단어가 없습니다.';
    return;
  }
  box.innerHTML = list.map((w,i)=>`
    <div style="padding:12px 8px;border-bottom:1px solid #eef1f6">
      <div style="font-weight:800;font-size:18px">${i+1}. ${w.en ?? w.word ?? ''}</div>
      <div style="color:#6b7280;margin-top:4px">${w.ko ?? w.mean ?? ''}</div>
      ${w.ex ? `<div style="margin-top:6px;color:#8891a6">예문: ${w.ex}</div>`:''}
    </div>
  `).join('');
}
async function onDateChanged(iso){
  const box = document.getElementById('listArea');
  box.textContent = '불러오는 중…';
  try{
    const words = await loadWordsFor(iso);
    renderWords(words);
  }catch(e){
    box.innerHTML = `<b>예시</b><div style="margin-top:6px">(${iso}) 단어 목록 로딩 훅을 연결하세요.</div>`;
  }
}

/* ===== 로그인 슬라이더 ===== */
const sheet = document.getElementById('accountSheet');
const openSheet = ()=>{ sheet.classList.add('open'); sheet.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; };
const closeSheet = ()=>{ sheet.classList.remove('open'); sheet.setAttribute('aria-hidden','true'); document.body.style.overflow=''; };
document.getElementById('moreBtn').addEventListener('click', openSheet);
document.getElementById('sheetClose').addEventListener('click', closeSheet);
document.getElementById('sheetBackdrop').addEventListener('click', closeSheet);

/* ===== 버튼 동작 ===== */
document.getElementById('prevDayBtn').addEventListener('click', ()=>shiftDate(-1));
document.getElementById('nextDayBtn').addEventListener('click', ()=>shiftDate(1));
document.getElementById('btnDone').addEventListener('click', markDoneAndNext);
document.getElementById('btnToday').addEventListener('click', goToday);

document.getElementById('btnAllPlay').addEventListener('click', ()=>alert('전체 재생 훅에 연결하세요'));
document.getElementById('btnStop').addEventListener('click', ()=>alert('정지 훅에 연결하세요'));

const mainPanel = document.getElementById('mainPanel');
document.getElementById('btnLog').addEventListener('click', ()=>{
  // 기록 탭 토글 (연결만)
  mainPanel.classList.toggle('logs-open');
  if (mainPanel.classList.contains('logs-open')){
    alert('기록 탭 열림 (여기에 기록 리스트를 렌더링하세요)');
  }
});
document.getElementById('btnDeleteLog').addEventListener('click', ()=>alert('선택 기록 삭제 기능을 연결하세요'));

/* 학습하기: study.html로 이동 */
document.getElementById('btnStudy').addEventListener('click', ()=>{
  const iso = fmt(currentDate);
  location.href = `study.html?date=${encodeURIComponent(iso)}`;
});

/* 초기 */
function init(){ goToday(); }
init();
</script>
</body>
</html>
