<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>오늘의 회화 영단어</title>
<style>
  body{margin:0;font-family:'Noto Sans KR',sans-serif;background:#f9fafb;color:#111827;}
  header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;background:#fff;border-bottom:1px solid #e5e7eb;position:sticky;top:0;z-index:50}
  h1{margin:0;font-size:20px;font-weight:700}
  .btn{background:#2563eb;color:#fff;border:none;border-radius:8px;padding:8px 14px;font-weight:600;cursor:pointer;white-space:nowrap;font-size:14px}
  .container{padding:20px;max-width:860px;margin:auto}
  .controls{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:20px}
  button{background:#fff;border:1px solid #d1d5db;border-radius:10px;padding:10px 14px;cursor:pointer;font-weight:600;color:#111827;text-align:center;white-space:nowrap;font-size:clamp(11px,2.5vw,14px)}
  button:hover{background:#f3f4f6}
  .btn-main{background:#2563eb;color:#fff;border:none}
  .btn-green{background:#16a34a;color:#fff;border:none}
  .word-card{background:#fff;padding:16px;margin-bottom:12px;border-radius:14px;box-shadow:0 2px 6px rgba(0,0,0,.05)}
  .word-head{display:flex;justify-content:space-between;align-items:center}
  .word-head h2{margin:0;font-size:21px;font-weight:700}
  .meaning{font-size:16px;color:#374151;margin:6px 0}
  .example{font-size:13px;color:#6b7280}
  .star{font-size:20px;cursor:pointer;color:#f59e0b}
  .actions{display:flex;gap:8px;margin-top:10px}
  .actions button{flex:1}
  /* 사이드 패널 */
  .side-panel{position:fixed;top:0;right:-300px;width:280px;height:100%;background:#fff;box-shadow:-2px 0 6px rgba(0,0,0,0.15);transition:right 0.3s ease;z-index:100;display:flex;flex-direction:column}
  .side-panel.open{right:0;}
  .side-header{display:flex;justify-content:space-between;align-items:center;padding:16px;border-bottom:1px solid #e5e7eb}
  .side-body{padding:16px;flex:1;display:flex;flex-direction:column;gap:12px}
  .avatar{width:48px;height:48px;border-radius:50%;background:#2563eb;color:#fff;display:flex;justify-content:center;align-items:center;font-weight:700;font-size:18px;margin-bottom:8px}
  .user-name{font-weight:700;font-size:16px}
  .user-email{font-size:13px;color:#6b7280}
  .btn-logout{background:#ef4444;color:#fff;border:none;padding:10px;border-radius:8px;cursor:pointer;font-weight:600}
</style>
</head>
<body>
  <header>
    <h1>오늘의 회화 영단어</h1>
    <button id="btn-auth-toggle" class="btn">로그인</button>
  </header>

  <div class="container">
    <div class="controls">
      <button id="btn-playall" class="btn-main">전체 재생</button>
      <button id="btn-stop">정지</button>
      <button id="btn-done" class="btn-green">오늘분 완료</button>
      <button id="btn-hard" class="btn">★ 어려운 단어</button>
      <button id="btn-history" class="btn">기록</button>
    </div>
    <div id="list"></div>
  </div>

  <!-- 사이드 패널 -->
  <div id="side-panel" class="side-panel">
    <div class="side-header">
      <strong>내 계정</strong>
      <button id="btn-close-panel">✕</button>
    </div>
    <div class="side-body">
      <div class="avatar" id="user-avatar">?</div>
      <div class="user-name" id="user-name">로그인 필요</div>
      <div class="user-email" id="user-email"></div>
      <button id="btn-logout" class="btn-logout">로그아웃</button>
    </div>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, GoogleAuthProvider, signInWithPopup, updateProfile, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBtN9HptAjl3wzemzKIr8nHvRHyOsvjsNI",
    authDomain: "voca-khw.firebaseapp.com",
    projectId: "voca-khw",
    storageBucket: "voca-khw.firebasestorage.app",
    messagingSenderId: "697341566223",
    appId: "1:697341566223:web:2a40f413b1edeb543c727a",
    measurementId: "G-Y5XZEX3W9X"
  };
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // DOM
  const sidePanel = document.getElementById('side-panel');
  document.getElementById('btn-auth-toggle').onclick=()=>sidePanel.classList.add('open');
  document.getElementById('btn-close-panel').onclick=()=>sidePanel.classList.remove('open');
  document.getElementById('btn-logout').onclick=async()=>{await signOut(auth);sidePanel.classList.remove('open');};

  // 로그인 상태 반영
  onAuthStateChanged(auth,(u)=>{
    if(u){
      document.getElementById('user-name').textContent=u.displayName||u.email.split('@')[0];
      document.getElementById('user-email').textContent=u.email;
      document.getElementById('user-avatar').textContent=(u.displayName?.[0]||u.email[0]||'?').toUpperCase();
    }else{
      document.getElementById('user-name').textContent='로그인 필요';
      document.getElementById('user-email').textContent='';
      document.getElementById('user-avatar').textContent='?';
    }
  });

  // 단어 목록 예시 렌더링
  async function fetchWords(){try{const r=await fetch('./words.json',{cache:'no-store'});return await r.json();}catch{return[]}}
  async function renderList(){
    const ws=await fetchWords();
    document.getElementById('list').innerHTML=ws.map(w=>`
      <div class="word-card">
        <div class="word-head">
          <h2>${w.phrase}</h2>
          <div class="star">☆</div>
        </div>
        <div class="meaning">${w.meaning}</div>
        <div class="example">${w.example||''}</div>
        <div class="actions">
          <button class="btn-main" onclick="speak('${encodeURIComponent(w.phrase)}','en')">EN</button>
          <button class="btn" onclick="speak('${encodeURIComponent(w.meaning)}','ko')">KO</button>
        </div>
      </div>`).join('');
  }
  renderList();

  window.speak=(t,lang)=>{const u=new SpeechSynthesisUtterance(decodeURIComponent(t));u.lang=lang==='ko'?'ko-KR':'en-US';speechSynthesis.cancel();speechSynthesis.speak(u);};
</script>
</body>
</html>
