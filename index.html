<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì˜¤ëŠ˜ì˜ íšŒí™” ì˜ë‹¨ì–´</title>
  <style>
    :root{
      --blue:#0b57d0; --blue-grad:#1a73e8; --bg:#f6f7fb; --card:#ffffff;
      --text:#111; --muted:#6b7280; --ok:#16a34a; --danger:#e11d48;
      --shadow:0 6px 20px rgba(0,0,0,.08);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Malgun Gothic,sans-serif}
    header{
      position:sticky;top:0;z-index:10;
      background:linear-gradient(90deg,var(--blue),var(--blue-grad));
      color:#fff; box-shadow:var(--shadow);
    }
    .wrap{max-width:980px;margin:0 auto;padding:18px}
    .title{font-size:22px;font-weight:800;letter-spacing:.2px}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .spacer{height:14px}

    /* ë‘¥ê·¼ ë²„íŠ¼ë“¤ */
    .btn{
      background:#fff;color:#0f172a;border:none;padding:12px 18px;border-radius:999px;
      box-shadow:var(--shadow);font-weight:700;cursor:pointer;transition:.2s;white-space:nowrap
    }
    .btn:active{transform:translateY(1px)}
    .btn.ok{background:var(--ok);color:#fff}
    .btn.danger{background:var(--danger);color:#fff}
    .btn.ghost{background:transparent;color:#fff;border:1.5px solid rgba(255,255,255,.7)}
    .btn.small{padding:8px 12px;font-weight:600}

    /* ìš°ìƒë‹¨ í† ê¸€(â—â—â—) */
    .fab{
      position:absolute;right:16px;top:50%;transform:translateY(-50%);
      width:44px;height:44px;border-radius:50%;display:grid;place-items:center;
      background:rgba(255,255,255,.2);border:1px solid rgba(255,255,255,.4);color:#fff;cursor:pointer;
    }
    .fab:active{transform:translateY(-50%) scale(.98)}
    .fab span{display:block;width:4px;height:4px;border-radius:50%;background:#fff;box-shadow:0 -8px 0 #fff,0 8px 0 #fff}

    /* ìŠ¬ë¼ì´ë“œ íŒ¨ë„ */
    .side{
      position:fixed;inset:0 0 0 auto;width:min(420px,92vw);background:#fff;box-shadow:-24px 0 40px rgba(0,0,0,.18);
      transform:translateX(100%);transition:transform .28s ease;z-index:20;display:flex;flex-direction:column
    }
    .side.open{transform:none}
    .side-head{display:flex;align-items:center;justify-content:space-between;padding:18px 20px;border-bottom:1px solid #eef1f6}
    .side-title{font-size:22px;font-weight:800}
    .side-close{width:40px;height:40px;border-radius:12px;border:1px solid #e5e7eb;background:#fff;display:grid;place-items:center;cursor:pointer}
    .side-body{padding:18px 20px;overflow:auto}
    .form{display:grid;gap:12px}
    label{font-size:13px;color:var(--muted);font-weight:700}
    input{
      width:100%;padding:14px 14px;border:1.5px solid #e5e7eb;border-radius:12px;outline:none;
      font-size:16px;background:#fff
    }
    input:focus{border-color:#c0d3ff;box-shadow:0 0 0 4px #e7f0ff}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .pill{display:inline-flex;gap:10px;align-items:center;background:#f2f4f8;color:#111;border-radius:999px;padding:8px 12px;font-weight:700}
    .muted{color:var(--muted);font-size:14px}

    /* ì½˜í…ì¸  ìë¦¬(ê¸°ì¡´ UI ìœ ì§€) */
    .content{max-width:980px;margin:20px auto;padding:0 18px}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}

    /* ë‚ ì§œ ë²„íŠ¼ í•œ ì¤„ ìœ ì§€ */
    .date-row{display:flex;gap:10px;align-items:center;flex-wrap:nowrap;overflow:hidden}
    .date{min-width:150px;max-width:150px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;
      text-align:center;background:#fff;border-radius:14px;padding:10px 12px;border:1.5px solid #e5e7eb;font-weight:800}

    @media (max-width:480px){
      .title{font-size:20px}
      .btn{padding:10px 14px}
      .date{min-width:140px;max-width:140px}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap" style="position:relative">
      <div class="title">ì˜¤ëŠ˜ì˜ íšŒí™” ì˜ë‹¨ì–´</div>
      <button id="menuBtn" class="fab" aria-label="ê³„ì • ì—´ê¸°"><span></span></button>
    </div>
  </header>

  <!-- ìƒë‹¨ ì»¨íŠ¸ë¡¤(ê¸°ì¡´ ë²„íŠ¼ë“¤ ê·¸ëŒ€ë¡œ) -->
  <div class="content">
    <div class="row">
      <button class="btn" id="btnPlayAll">ì „ì²´ ì¬ìƒ</button>
      <button class="btn" id="btnStop">ì •ì§€</button>
      <button class="btn ok" id="btnDone">ì˜¤ëŠ˜ë¶„ ì™„ë£Œ</button>
      <button class="btn" id="btnHard">â˜… ì–´ë ¤ìš´ ë‹¨ì–´</button>
      <button class="btn" id="btnLog">ê¸°ë¡</button>
      <button class="btn danger" id="btnDel">ê¸°ë¡ ì‚­ì œ</button>
    </div>
    <div class="spacer"></div>
    <div class="card">
      <div class="date-row">
        <button class="btn small" id="prevDay">â—€</button>
        <div id="dateBadge" class="date">YYYY-MM-DD</div>
        <button class="btn small" id="nextDay">â–¶</button>
        <button class="btn" id="todayBtn">ì˜¤ëŠ˜ì˜ ë‹¨ì–´</button>
      </div>
      <div class="spacer"></div>
      <div class="muted">ì—¬ê¸°ì— ë‹¨ì–´ ë¦¬ìŠ¤íŠ¸ / ë°œìŒ / ê¸°íƒ€ UIê°€ ê·¸ëŒ€ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤â€¦ (ê¸°ëŠ¥ ìœ ì§€)</div>
    </div>
  </div>

  <!-- ìŠ¬ë¼ì´ë“œ íŒ¨ë„: ë¡œê·¸ì¸ / íšŒì›ê°€ì… / Google ë¡œê·¸ì¸ -->
  <aside id="side" class="side" aria-hidden="true">
    <div class="side-head">
      <div class="side-title">ê³„ì •</div>
      <button class="side-close" id="sideClose" aria-label="ë‹«ê¸°">âœ•</button>
    </div>
    <div class="side-body">
      <!-- ë¡œê·¸ì¸ ì˜ì—­ -->
      <div id="loginArea">
        <div class="pill">ìƒíƒœ: <span id="authState" class="muted">ë¡œê·¸ì•„ì›ƒë¨</span></div>
        <div class="spacer"></div>
        <form id="loginForm" class="form" autocomplete="on">
          <div>
            <label>ì´ë©”ì¼</label>
            <input id="loginEmail" type="email" placeholder="you@example.com" required />
          </div>
          <div>
            <label>ë¹„ë°€ë²ˆí˜¸</label>
            <input id="loginPw" type="password" placeholder="8ìë¦¬ ì´ìƒ" minlength="8" required />
          </div>
          <div class="grid2">
            <button type="submit" class="btn">ë¡œê·¸ì¸</button>
            <button type="button" id="toSignup" class="btn">íšŒì›ê°€ì…</button>
          </div>
        </form>
        <div class="spacer"></div>
        <button id="googleBtn" class="btn" style="width:100%">Googleë¡œ ë¡œê·¸ì¸</button>
      </div>

      <!-- íšŒì›ê°€ì… ì˜ì—­ -->
      <div id="signupArea" style="display:none">
        <div class="pill">ìƒˆ ê³„ì • ë§Œë“¤ê¸°</div>
        <div class="spacer"></div>
        <form id="signupForm" class="form" autocomplete="off">
          <div>
            <label>ì•„ì´ë”” (ë¬¸ì„œ ID)</label>
            <input id="sgId" type="text" placeholder="ì˜ë¬¸/ìˆ«ì ì¡°í•©" required />
          </div>
          <div>
            <label>ë‹‰ë„¤ì„</label>
            <input id="sgNick" type="text" placeholder="ë³„ëª…" required />
          </div>
          <div>
            <label>ì´ë©”ì¼</label>
            <input id="sgEmail" type="email" placeholder="you@example.com" required />
          </div>
          <div>
            <label>ë¹„ë°€ë²ˆí˜¸</label>
            <input id="sgPw" type="password" placeholder="8ìë¦¬ ì´ìƒ" minlength="8" required />
          </div>
          <div>
            <label>ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
            <input id="sgPw2" type="password" placeholder="ë‹¤ì‹œ ì…ë ¥" minlength="8" required />
          </div>
          <div class="grid2">
            <button type="button" id="backToLogin" class="btn">ì·¨ì†Œ</button>
            <button type="submit" class="btn ok">íšŒì›ê°€ì… ì™„ë£Œ</button>
          </div>
        </form>
      </div>

      <!-- ë¡œê·¸ì¸ í›„ ì •ë³´ -->
      <div id="profileArea" style="display:none">
        <div class="pill">ë¡œê·¸ì¸ë¨</div>
        <div class="spacer"></div>
        <div class="card" style="padding:14px;border:1.5px solid #eef1f6">
          <div class="muted">ì´ë©”ì¼</div>
          <div id="pfEmail" style="font-weight:800;margin-bottom:8px">-</div>
          <div class="muted">ë‹‰ë„¤ì„(ì €ì¥ê°’)</div>
          <div id="pfNick" style="font-weight:800">-</div>
        </div>
        <div class="spacer"></div>
        <button id="logoutBtn" class="btn danger" style="width:100%">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    </div>
  </aside>

  <!-- Firebase SDK (v10 modular) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut,
             GoogleAuthProvider, signInWithPopup, createUserWithEmailAndPassword } 
             from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc } 
             from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    // ğŸ‘‰ í˜„ìš°ë‹˜ í”„ë¡œì íŠ¸ ì„¤ì • (í•„ìš”ì‹œ êµì²´)
    const firebaseConfig = {
      apiKey: "AIzaSyBtN9HptAjl3wzemzKIr8nHvRHyOsvjsNI",
      authDomain: "voca-khw.firebaseapp.com",
      projectId: "voca-khw",
      storageBucket: "voca-khw.firebasestorage.app",
      messagingSenderId: "697341566223",
      appId: "1:697341566223:web:2a40f413b1edeb543c727a",
      measurementId: "G-Y5XZEX3W9X"
    };

    // Firebase init
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // UI refs
    const side = document.getElementById('side');
    const menuBtn = document.getElementById('menuBtn');
    const sideClose = document.getElementById('sideClose');

    const loginArea = document.getElementById('loginArea');
    const signupArea = document.getElementById('signupArea');
    const profileArea = document.getElementById('profileArea');

    const authState = document.getElementById('authState');
    const pfEmail = document.getElementById('pfEmail');
    const pfNick  = document.getElementById('pfNick');

    // ì—´ê³  ë‹«ê¸°
    const openSide = () => { side.classList.add('open'); side.setAttribute('aria-hidden','false'); }
    const closeSide = () => { side.classList.remove('open'); side.setAttribute('aria-hidden','true'); }
    menuBtn.addEventListener('click', openSide);
    sideClose.addEventListener('click', closeSide);
    // íŒ¨ë„ ë°– í„°ì¹˜ ë‹«í˜ (ëª¨ë°”ì¼ í¬í•¨)
    document.addEventListener('click', (e)=>{
      if(!side.classList.contains('open')) return;
      const within = side.contains(e.target) || menuBtn.contains(e.target);
      if(!within) closeSide();
    });

    // ìƒíƒœ ì „í™˜
    function showLogin(){
      loginArea.style.display='block';
      signupArea.style.display='none';
      profileArea.style.display='none';
    }
    function showSignup(){
      loginArea.style.display='none';
      signupArea.style.display='block';
      profileArea.style.display='none';
    }
    function showProfile(){
      loginArea.style.display='none';
      signupArea.style.display='none';
      profileArea.style.display='block';
    }

    // ë¡œê·¸ì¸ í¼
    document.getElementById('loginForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = document.getElementById('loginEmail').value.trim();
      const pw    = document.getElementById('loginPw').value;
      try{
        await signInWithEmailAndPassword(auth, email, pw);
        // ì„±ê³µ ì‹œ íŒ¨ë„ ìœ ì§€(í”„ë¡œí•„ë¡œ ì „í™˜)
      }catch(err){
        alert(`ë¡œê·¸ì¸ ì‹¤íŒ¨: ${err.message}`);
      }
    });

    // êµ¬ê¸€ ë¡œê·¸ì¸
    document.getElementById('googleBtn').addEventListener('click', async ()=>{
      try{
        await signInWithPopup(auth, provider);
      }catch(err){
        alert(`Google ë¡œê·¸ì¸ ì‹¤íŒ¨: ${err.message}`);
      }
    });

    // íšŒì›ê°€ì… í† ê¸€
    document.getElementById('toSignup').addEventListener('click', showSignup);
    document.getElementById('backToLogin').addEventListener('click', showLogin);

    // íšŒì›ê°€ì… ì²˜ë¦¬: Auth ê³„ì • ìƒì„± + Firestore /users/{id}
    document.getElementById('signupForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const id  = document.getElementById('sgId').value.trim();
      const nickname = document.getElementById('sgNick').value.trim();
      const email    = document.getElementById('sgEmail').value.trim();
      const pw1      = document.getElementById('sgPw').value;
      const pw2      = document.getElementById('sgPw2').value;

      if(pw1 !== pw2){ alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; }
      if(!/^[a-zA-Z0-9_-]{3,30}$/.test(id)){ alert('ì•„ì´ë””ëŠ” 3~30ìì˜ ì˜ë¬¸/ìˆ«ì/_- ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.'); return; }

      try{
        // 1) ê°™ì€ ì•„ì´ë”” ë¬¸ì„œ ì¡´ì¬ ì—¬ë¶€ ê²€ì‚¬
        const userDocRef = doc(db, 'users', id);
        const snap = await getDoc(userDocRef);
        if(snap.exists()){ alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }

        // 2) Firebase Auth ê³„ì • ìƒì„± (ì´ë©”ì¼/ë¹„ë²ˆ)
        await createUserWithEmailAndPassword(auth, email, pw1);

        // 3) Firestore ì‚¬ìš©ì ì •ë³´ ì €ì¥
        await setDoc(userDocRef, {
          id, nickname, email,
          createdAt: new Date().toISOString()
        });

        alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìë™ ë¡œê·¸ì¸ ë˜ì—ˆìŠµë‹ˆë‹¤.');
        // ìƒíƒœ ë³€í™”ëŠ” onAuthStateChangedì—ì„œ ì²˜ë¦¬
      }catch(err){
        alert(`íšŒì›ê°€ì… ì‹¤íŒ¨: ${err.message}`);
      }
    });

    // ë¡œê·¸ì•„ì›ƒ
    document.getElementById('logoutBtn').addEventListener('click', async ()=>{
      try{ await signOut(auth); }catch(e){ alert(e.message); }
    });

    // ì¸ì¦ ìƒíƒœ ê°ì‹œ â†’ UI ë™ê¸°í™”
    onAuthStateChanged(auth, async (user)=>{
      if(user){
        authState.textContent = 'ë¡œê·¸ì¸ë¨';
        // Firestoreì—ì„œ ë‹‰ë„¤ì„ ì¡°íšŒ(ìˆëŠ” ê²½ìš°)
        let nickTxt = '-';
        try{
          // ì´ë©”ì¼ë¡œ ì°¾ëŠ”ê²Œ ì•„ë‹ˆë¼, ìš°ë¦¬ê°€ ë§Œë“  /users/{id} êµ¬ì¡°ë¼ë©´
          // ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ ì´ë©”ì¼ê³¼ ì¼ì¹˜í•˜ëŠ” ë¬¸ì„œë¥¼ ì—­ê²€ìƒ‰í•˜ì§€ ì•Šê³ 
          // ë‹‰ë„¤ì„ì€ ì—†ëŠ” ê²½ìš°ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë‹ˆ Optional ì²˜ë¦¬
          // (idë¥¼ ë³„ë„ë¡œ ì €ì¥í•˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ, ìƒ˜í”Œë¡œ ì´ë©”ì¼ ë³´ì´ê¸°)
          nickTxt = '(ì €ì¥ëœ ë‹‰ë„¤ì„ ì¡°íšŒí•˜ë ¤ë©´ idë¥¼ ì•Œê³  ìˆì–´ì•¼ í•©ë‹ˆë‹¤)';
        }catch{}
        pfEmail.textContent = user.email || '-';
        pfNick.textContent  = nickTxt;

        showProfile();
      }else{
        authState.textContent = 'ë¡œê·¸ì•„ì›ƒë¨';
        showLogin();
      }
    });

    /* ====== ì•„ë˜ëŠ” ê¸°ì¡´ ë‹¨ì–´/ë‚ ì§œ ê¸°ëŠ¥ ìë¦¬ë¥¼ ìœ„í•œ ê°„ë‹¨í•œ í‹€ë§Œ ìœ ì§€ ======
       (í˜„ìš°ë‹˜ì´ ì“°ì‹œë˜ ê¸°ëŠ¥ ì½”ë“œ ê·¸ëŒ€ë¡œ ë‘ì‹œê³ , ìœ„ì˜ Auth/Firestore ë¶€ë¶„ë§Œ í•©ì¹˜ë©´ ë©ë‹ˆë‹¤)
    */
    const dateBadge = document.getElementById('dateBadge');
    function fmt(d){ return d.toISOString().slice(0,10); }
    let cur = new Date();
    dateBadge.textContent = fmt(cur);
    document.getElementById('prevDay').onclick = ()=>{cur.setDate(cur.getDate()-1);dateBadge.textContent=fmt(cur);};
    document.getElementById('nextDay').onclick = ()=>{cur.setDate(cur.getDate()+1);dateBadge.textContent=fmt(cur);};
    document.getElementById('todayBtn').onclick = ()=>{cur=new Date();dateBadge.textContent=fmt(cur);};
  </script>
</body>
</html>
