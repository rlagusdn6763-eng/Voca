<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì˜¤ëŠ˜ì˜ íšŒí™” ì˜ë‹¨ì–´</title>
<style>
  :root { --bg:#0b1220; --card:#0f172a; --line:#1f2937; --text:#e5e7eb; --muted:#9ca3af; --btn:#0b7285; --btn2:#334155; }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans KR,Arial}
  .wrap{max-width:860px;margin:32px auto;padding:0 16px}
  h1{margin:0 0 4px;font-size:28px;font-weight:800;letter-spacing:-.3px}
  .sub{color:var(--muted);font-size:14px;margin:0 0 16px}
  .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:12px 0 16px}
  button{background:var(--btn);border:1px solid #0c8599;color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer;font-size:14px}
  button.secondary{background:var(--btn2);border-color:var(--btn2);color:#cbd5e1}
  select,input[type="range"]{background:#0b1324;border:1px solid var(--line);color:var(--text);padding:7px 9px;border-radius:10px;font-size:14px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:6px}
  .row{display:grid;grid-template-columns:1fr auto;gap:10px;padding:12px;border-top:1px dashed var(--line)}
  .row:first-child{border-top:none}
  .en{font-weight:800;font-size:18px}
  .ko{color:var(--muted);font-size:14px;margin-top:2px}
  footer{color:var(--muted);font-size:12px;margin:16px 0;text-align:center}
  .hint{margin-top:8px}
</style>
</head>
<body>
<div class="wrap">
  <h1>ì˜¤ëŠ˜ì˜ íšŒí™” ì˜ë‹¨ì–´</h1>
  <p class="sub" id="status">í´ë¦­í•´ì„œ ë°œìŒ ë“¤ì–´ë³´ê¸°</p>

  <div class="toolbar">
    <button id="playAll">ì „ì²´ ì¬ìƒ</button>
    <button id="stopAll" class="secondary">ì •ì§€</button>
    <select id="voiceSelect" title="ì˜ì–´ ìŒì„± ì„ íƒ"></select>
    <label style="display:flex;align-items:center;gap:8px">
      <span style="color:#9ca3af;font-size:13px">ì†ë„</span>
      <input id="rate" type="range" min="0.6" max="1.2" step="0.05" value="1" />
    </label>
  </div>

  <div class="card" id="list"></div>

  <p class="sub hint">ğŸ’¡ ë°œìŒì´ ì–´ìƒ‰í•˜ë©´ ìœ„ì˜ <b>voice</b>ì—ì„œ English(US/UK) ìŒì„±ì„ ê³ ë¥´ì„¸ìš”.</p>
  <footer>GitHub Pages Â· Web Speech API</footer>
</div>

<script>
async function loadWords(){
  const status = document.getElementById('status');
  try {
    status.textContent = 'ë‹¨ì–´ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦';
    // ì—´ë¦¬ëŠ” ìœ„ì¹˜ì— ë”°ë¼ words.json ê²½ë¡œ ìë™ ë³´ì •
    const base = location.pathname.includes('/Voca/') ? '/Voca/' : '/';
    const res = await fetch(base + 'words.json?ts=' + Date.now()); // ìºì‹œ ë¬´ë ¥í™”
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const data = await res.json();
    if (!Array.isArray(data)) throw new Error('JSON í˜•ì‹ì´ ë°°ì—´ì´ ì•„ë‹˜');
    render(data);
    status.textContent = `í´ë¦­í•´ì„œ ë°œìŒ ë“¤ì–´ë³´ê¸° Â· ${data.length}ê°œ ë¡œë“œë¨`;
  } catch (err) {
    status.textContent = 'ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + err.message;
    console.error(err);
  }
}

function render(data){
  const list = document.getElementById('list');
  list.innerHTML = '';
  data.forEach((it, i) => {
    const row = document.createElement('div');
    row.className = 'row';
    row.innerHTML = `
      <div>
        <div class="en">${it.phrase}</div>
        <div class="ko">${it.meaning ?? ''}</div>
      </div>
      <div style="display:flex;gap:8px">
        <button data-i="${i}" class="speak">â–¶ ì¬ìƒ</button>
        <button data-i="${i}" class="slow secondary">ëŠë¦¬ê²Œ</button>
      </div>
    `;
    list.appendChild(row);
  });

  // ìŒì„± ëª©ë¡ ì±„ìš°ê¸°
  const voiceSelect = document.getElementById('voiceSelect');
  const rateEl = document.getElementById('rate');
  let voices = [];
  function fillVoices(){
    voices = speechSynthesis.getVoices();
    const en = voices.filter(v => /en(-|_)|English/i.test(v.lang));
    voiceSelect.innerHTML = '';
    (en.length ? en : voices).forEach(v => {
      const o = document.createElement('option');
      o.value = v.name;
      o.textContent = `${v.name} â€” ${v.lang}`;
      voiceSelect.appendChild(o);
    });
  }
  fillVoices();
  speechSynthesis.onvoiceschanged = fillVoices;

  function speak(text, rate = 1){
    speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    const chosen = voices.find(v => v.name === voiceSelect.value);
    if (chosen) u.voice = chosen;
    u.lang = (chosen && chosen.lang) || 'en-US';
    u.rate = rate;
    speechSynthesis.speak(u);
  }

  list.querySelectorAll('.speak').forEach(btn => {
    btn.addEventListener('click', e => {
      const idx = +e.currentTarget.dataset.i;
      speak(data[idx].phrase, Number(rateEl.value));
    });
  });
  list.querySelectorAll('.slow').forEach(btn => {
    btn.addEventListener('click', e => {
      const idx = +e.currentTarget.dataset.i;
      speak(data[idx].phrase, 0.8);
    });
  });

  document.getElementById('playAll').onclick = async () => {
    speechSynthesis.cancel();
    const rate = Number(rateEl.value);
    for (const item of data) {
      await new Promise(res => {
        const u = new SpeechSynthesisUtterance(item.phrase);
        const chosen = voices.find(v => v.name === voiceSelect.value);
        if (chosen) u.voice = chosen;
        u.lang = (chosen && chosen.lang) || 'en-US';
        u.rate = rate;
        u.onend = () => setTimeout(res, 200);
        speechSynthesis.speak(u);
      });
    }
  };
  document.getElementById('stopAll').onclick = () => speechSynthesis.cancel();
}

loadWords();
</script>
</body>
</html>
