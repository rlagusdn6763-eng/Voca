<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>학습하기</title>
<style>
  :root{--blue1:#0a58ff;--blue2:#1170ff;--bg:#f6f7fb;--card:#fff;--muted:#6b7280;--green:#18a16a;--red:#e74c3c;--radius:16px}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:#111;font-family:-apple-system,system-ui,Segoe UI,Roboto,Noto Sans KR,Apple SD Gothic Neo,Helvetica,Arial,sans-serif}
  .appbar{position:sticky;top:0;z-index:1000;background:linear-gradient(90deg,var(--blue1),var(--blue2));color:#fff;padding:14px 16px 16px;display:flex;align-items:center;gap:12px}
  .title{font-size:22px;font-weight:800}.spacer{flex:1}.icon-btn{width:44px;height:44px;border-radius:12px;border:0;background:rgba(255,255,255,.18);color:#fff;font-size:20px;display:flex;align-items:center;justify-content:center;cursor:pointer}
  .wrap{padding:16px;max-width:840px;margin:0 auto}
  .card{background:var(--card);border-radius:var(--radius);box-shadow:0 8px 18px rgba(0,0,0,.06);padding:16px}
  .muted{color:var(--muted)} .mt8{margin-top:8px}.mt12{margin-top:12px}
  .choice{width:100%;border:1px solid #e5e7eb;border-radius:12px;background:#fff;height:44px;padding:0 14px;text-align:left;font-weight:600}
  .row{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px}
</style>
</head>
<body>
<header class="appbar">
  <div class="title">학습하기</div>
  <div class="spacer"></div>
  <button id="goBack" class="icon-btn" title="뒤로" aria-label="뒤로">↩</button>
  <button id="openAccount" class="icon-btn" title="계정" aria-label="계정">⋯</button>
</header>

<main class="wrap">
  <section class="card">
    <h2>오늘의 학습</h2>
    <div id="meta" class="muted mt8"></div>
    <div id="qbox" class="mt12">문제 영역이 여기에 렌더링됩니다…</div>
    <div class="row mt12">
      <button id="prev" class="choice">이전</button>
      <button id="next" class="choice">다음</button>
      <button id="finish" class="choice" style="background:var(--red);color:#fff;border-color:transparent">끝내기</button>
    </div>
  </section>
</main>

<script>
/* 공통 */
const $=s=>document.querySelector(s);
$("#goBack").onclick=()=>history.back();

/* 데이터 로드 */
const params=new URLSearchParams(location.search);
const date=params.get("date")||new Date().toISOString().slice(0,10);
const key=`words_${date}`;
let words=JSON.parse(localStorage.getItem(key)||"[]");
if(!words.length){
  // index에서 저장된게 없을 때 샘플 생성
  words=[
    {i:1,en:"make do with",ko:"임시방편으로 사용하다",ex:"We had to make do with what we had."},
    {i:2,en:"depend on",ko:"의지하다",ex:"You can depend on me."},
    {i:3,en:"get along with",ko:"잘 지내다",ex:"Do you get along with your neighbors?"},
    {i:4,en:"stick to",ko:"고수하다",ex:"Stick to the plan."},
    {i:5,en:"pick out",ko:"고르다",ex:"She picked out a dress."},
    {i:6,en:"call off",ko:"취소하다",ex:"They called off the meeting."},
    {i:7,en:"nod off",ko:"꾸벅꾸벅 졸다",ex:"He nodded off during the lecture."},
    {i:8,en:"show off",ko:"뽐내다",ex:"He likes to show off."},
    {i:9,en:"put away",ko:"치우다",ex:"Please put away your toys."},
    {i:10,en:"run into",ko:"우연히 만나다",ex:"I ran into an old friend."}
  ];
}

/* 문제 생성: ① 단어→뜻 ② 예문 빈칸 */
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}
const bank=[];
words.forEach(w=>{
  // 유형 A: 뜻 고르기
  const wrongs=shuffle(words.filter(x=>x.en!==w.en)).slice(0,3).map(x=>x.ko);
  bank.push({type:"ko", stem:`${w.en} 의 뜻을 고르세요.`, choices:shuffle([w.ko,...wrongs]), answer:w.ko});
  // 유형 B: 예문 빈칸 (정답 힌트 제거!)
  const sentence=w.ex.replace(new RegExp(w.en,"i"),"_____");
  const wrongP=shuffle(words.filter(x=>x.en!==w.en)).slice(0,3).map(x=>x.en);
  bank.push({type:"gap", stem:`${sentence}`, choices:shuffle([w.en,...wrongP]), answer:w.en});
});
const quiz=bank.slice(0,10); // 10문제

/* 진행 상태 */
let idx=0, correct=0; const meta=$("#meta"), qbox=$("#qbox");
function render(){
  meta.textContent=`${idx+1} / ${quiz.length} · 정답 ${correct}`;
  const q=quiz[idx];
  qbox.innerHTML=`
    <div style="font-size:20px;font-weight:800">${q.type==="ko"?"뜻 고르기":"예문 빈칸"}</div>
    <div class="mt12" style="font-size:18px">${q.stem}</div>
    <div class="mt12" style="display:grid;gap:10px">
      ${q.choices.map((c,i)=>`<button class="choice" data-i="${i}">${c}</button>`).join("")}
    </div>
  `;
  qbox.querySelectorAll(".choice").forEach(btn=>{
    btn.onclick=()=>{
      const pick=btn.textContent.trim();
      const ok=pick===q.answer;
      if(ok){correct++; btn.style.borderColor="var(--green)"; btn.style.background="var(--green)"; btn.style.color="#fff";}
      else {btn.style.borderColor="var(--red)"; btn.style.background="var(--red)"; btn.style.color="#fff";}
      setTimeout(()=>{ if(idx<quiz.length-1){idx++; render();} else {finish();}}, 350);
    };
  });
}
render();

$("#prev").onclick=()=>{ if(idx>0){idx--; render();} };
$("#next").onclick=()=>{ if(idx<quiz.length-1){idx++; render();} };
const finish=()=>{ alert(`학습 완료! 점수: ${correct} / ${quiz.length}`); history.back(); };
$("#finish").onclick=finish;
</script>
</body>
</html>
